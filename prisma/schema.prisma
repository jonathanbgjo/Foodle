generator client {
  provider = "prisma-client"
  output   = "../src/generated"
}

datasource db {
  provider = "postgresql"
}

model RecipeRecord {
  id          String   @id @default(cuid())
  inputUrl    String
  resolvedUrl String?
  sourceType  SourceType

  title       String
  cuisine     String?
  mealType    String?
  recipeJson  Json
  rawText     String?   // extracted page text used for AI fallback
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tags        RecipeTag[]
}

model Tag {
  id      String @id @default(cuid())
  name    String @unique
  recipes RecipeTag[]
}

model RecipeTag {
  recipeId String
  tagId    String

  recipe   RecipeRecord @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  tag      Tag          @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([recipeId, tagId])
}

enum SourceType {
  PAGE_SCRAPE
  PAGE_TEXT_AI
}
